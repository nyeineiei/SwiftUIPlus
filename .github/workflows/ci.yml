---

name: SwiftUIPlus CI

"on":
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  test:
    runs-on: macos-13

    steps:
      - name: â¬‡ï¸ Checkout code
        uses: actions/checkout@v3

      - name: ðŸ§ª Run Swift tests with coverage
        run: |
          swift test --enable-code-coverage \
            -Xswiftc -profile-generate \
            -Xswiftc -profile-coverage-mapping

      - name: ðŸ“Š Generate coverage report
        run: |
          TEST_BINARY=".build/debug/SwiftUIPlusPackageTests.xctest/Contents/MacOS/SwiftUIPlusPackageTests"
          PROF_DATA=".build/debug/codecov/default.profdata"

          if [ ! -f "$PROF_DATA" ]; then
            echo "âš ï¸ Coverage data not found"
            exit 1
          fi

          xcrun llvm-cov export -format="lcov" \
            "$TEST_BINARY" \
            -instr-profile "$PROF_DATA" \
            > coverage.lcov

      - name: ðŸ“¤ Upload coverage report
        uses: actions/upload-artifact@v3
        with:
          name: code-coverage
          path: coverage.lcov
